<style>

</style>
<% unless @prev_date.present? %>
<% @prev_date = msg.created_at.strftime('%d %b, %Y') %>
<% end %>

<% if @messages.next_page.nil? && i == (@messages.size - 1) %>
<%# @prev_date = msg.created_at.strftime('%d %b, %Y') %>
<div class="chat-date-separator" style="margin-left: 40%">
    <span>
        <% if Date.parse(msg.created_at.strftime('%d %b, %Y')) == Date.today %>
        Today
        <% elsif Date.parse(msg.created_at.strftime('%d %b, %Y')) == Date.yesterday %>
        Yesterday
        <% else %>
        <%= msg.created_at.strftime('%d %b, %Y') %>
        <% end %>
    </span>
</div>
<% end %>
<% if  (request.referer && request.env["HTTP_REFERER"].split("conversation").count <= 1)%>

<% if msg.userable == get_current_user %>
<div class="chat-message self">

    <div class="row justify-content-end w-100 pl-1">
        <div class="col-sm-10 col-md-10 col-lg-10 chat-messagediv-style-mini">
            <div class="chat-message-content-w">
                <div class="chat-message-content w-100 text-break">
                    <%= msg.body.html_safe %>
                    <% if msg.rate_confirmation? %>
                    <a href="<%= get_current_user.class.to_s == 'Candidate' ? accept_rate_candidate_job_application_path(msg.conversation.job_application, msg.conversation) :
                                  accept_rate_job_application_path(msg.conversation.job_application, msg.conversation)

                    %>" data-method=' post'>
                        Click Here </a> to Accept or
                    <a href='' data-toggle='modal' data-target="#candicontentdate-rate-confirmation-<%= msg.conversation.job_application.applicationable_id %>">Click
                        Here</a> to Counter
                    <% end %>

                    <% if msg.schedule_interview? %>
                    <a data-method='post' href="<%= get_current_user.class.to_s == 'Candidate' ?
                                                      accept_interview_candidate_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id)
                                                      :
                                                      accept_interview_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id) %>">Click Here </a> accept this time or
                    <a class='btn-link mt-12 margin-right-5' data-toggle='modal' data-target='#candidate-interview-<%= msg.conversation.job_application.applicationable_id %>' href='#'>
                        Click Here
                    </a> to change details
                    <% end %>
                    <% if msg.file_url.present? %>
                    <hr />
                    <a href=<%= msg.file_url %> target="_blank">Attachment</a>
                    <% end %>
                </div>
            </div>
        </div>
        <div class="col-sm-2 col-md-2 col-lg-2 avatar-style">
            <div class="chat-message-avatar">
                <% if msg.userable.photo&.present? %>
                <%= image_tag(msg.userable.photo, class: "image-35-imp new-class-avatar new-class-new", alt: image_alt(msg.userable)) %>
                <% else %>
                <%= entity_image(msg.userable.first_name, msg.userable.last_name, 'circle', "image-35-imp") %>
                <% end %>
            </div>
        </div>
    </div>

</div>
<% else %>

<div class="row w-100 ml-1 d-flex">
    <div class="col-sm-3 col-md-3 col-lg-3">
        <div class="chat-message-avatar d-flex justify-content-center">
            <% if msg.userable.photo&.present? %>
            <%= image_tag(msg.userable.photo, class: "image-35-imp new-class-avatar", alt: image_alt(msg.userable)) %>
            <% else %>
            <%= entity_image(msg.userable.first_name, msg.userable.last_name, 'circle', "image-35-imp") %>
            <% end %>
        </div>
    </div>
    <div class="col-sm-8 col-md-8 col-lg-8 chat-message-divstyle-mini">
        <div class="chat-message-content-w">
            <div class="chat-message-content w-100 text-break">
                <%= msg.body.html_safe %>
                <% if msg.rate_confirmation? %>
                <a href="<%= get_current_user.class.to_s == 'Candidate' ? accept_rate_candidate_job_application_path(msg.conversation.job_application, msg.conversation) :
                                accept_rate_job_application_path(msg.conversation.job_application, msg.conversation)
                  %>" data-method='post'>
                    Click Here </a> to Accept or
                <a href='' data-toggle='modal' data-target="#candidate-rate-confirmation-<%= msg.conversation.job_application.applicationable_id %>">Click
                    Here</a> to Counter
                <% end %>
                <% if msg.schedule_interview? %>
                <a data-method='post' href="<%= get_current_user.class.to_s == 'Candidate' ?
                                                    accept_interview_candidate_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id)
                                                    :
                                                    accept_interview_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id) %>">Click Here </a> accept this time or
                <a class='btn-link mt-12 margin-right-5' data-toggle='modal' data-target="#candidate-interview-<%= msg.conversation.job_application.applicationable_id %>" href='#'>
                    Click Here
                </a> to change details
                <% end %>
                <% if msg.file_url.present? %>
                <hr />
                <a href=<%= msg.file_url %> target="_blank">Attachment</a>
                <% end %>
            </div>
        </div>
    </div>
</div>

<div class="chat-message left" style="margin-bottom: 14px">
    <div class="row" style="margin-top: auto">
        <div class="col-lg-7 col-md-7 col-sm-7">
            <div class="row" style="justify-content: flex-start; background: #F1F8FF;
              border-radius: 21px; border-bottom-right-radius: unset"> </div>
        </div>
        <div class="col-lg-2 col-md-2 col-sm-2">
            <div class="row" style="justify-content: flex-start"> </div>
        </div>
        <div class="col-lg-3 col-md-3 col-sm-3"></div>
    </div>
</div>
<% end %>
<%else%>
<%# main chat %>
<% if msg.userable == get_current_user %>
<div class="chat-message self">

    <div class="row" style="justify-content: flex-end; margin-left: 1px; width: 100%; ">
        <div class="col-sm-5 col-md-5 col-lg-5 chat-messagediv-style" >
            <div class="chat-message-content-w">
                <div class="chat-message-content text-break">
                    <%= msg.body.html_safe %>
                    <% if msg.rate_confirmation? %>
                    <a href=" <%= get_current_user.class.to_s == 'Candidate' ? accept_rate_candidate_job_application_path(msg.conversation.job_application, msg.conversation) :
                             accept_rate_job_application_path(msg.conversation.job_application, msg.conversation)

              %>" data-method='post'>
                        Click Here </a> to Accept or
                    <a href='' data-toggle='modal' data-target="#candidate-rate-confirmation-<%= msg.conversation.job_application.applicationable_id %>">Click
                        Here</a> to Counter
                    <% end %>

                    <% if msg.schedule_interview? %>
                    <a data-method='post' href="<%= get_current_user.class.to_s == 'Candidate' ?
                                                accept_interview_candidate_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id)
                                                :
                                                accept_interview_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id) %>">Click Here </a> accept this time or
                    <a class='btn-link mt-12 margin-right-5' data-toggle='modal' data-target='#candidate-interview-<%= msg.conversation.job_application.applicationable_id %>' href='#'>
                        Click Here
                    </a> to change details
                    <% end %>
                    <% if msg.file_url.present? %>
                    <hr />
                    <a href=<%= msg.file_url %> target="_blank">Attachment</a>
                    <% end %>
                </div>
            </div>
        </div>
        <div class="col-sm-1 col-md-1 col-lg-1 newpad-class">
            <div class="chat-message-avatar" style="justify-content: flex-end;
    display: flex;">
                <% if msg.userable.photo&.present? %>
                <%= image_tag(msg.userable.photo, class: "image-35-imp new-class-avatar", alt: image_alt(msg.userable)) %>
                <% else %>
                <%= entity_image(msg.userable.first_name, msg.userable.last_name, 'circle', "image-35-imp") %>
                <% end %>
            </div>
        </div>
    </div>

</div>

<% else %>

<div class="row" style="margin-left: 1px;width: 100%">
    <div class="col-sm-1 col-md-1 col-lg-1" style=" margin-top: auto;">
        <div class="chat-message-avatar">
            <% if msg.userable.photo&.present? %>
            <%= image_tag(msg.userable.photo, class: "image-35-imp new-class-avatar", alt: image_alt(msg.userable)) %>
            <% else %>
            <%= entity_image(msg.userable.first_name, msg.userable.last_name, 'circle', "image-35-imp") %>
            <% end %>
        </div>
    </div>
    <div class="col-sm-5 col-md-5 col-lg-5 chat-message-divstyle">
        <div class="chat-message-content-w">
            <div class="chat-message-content text-break">
                <%= msg.body.html_safe %>
                <% if msg.rate_confirmation? %>
                <a href=" <%= get_current_user.class.to_s == 'Candidate' ? accept_rate_candidate_job_application_path(msg.conversation.job_application, msg.conversation) :
                           accept_rate_job_application_path(msg.conversation.job_application, msg.conversation)
            %>" data-method='post'>
                    Click Here </a> to Accept or
                <a href='' data-toggle='modal' data-target="#candidate-rate-confirmation-<%= msg.conversation.job_application.applicationable_id %>">Click
                    Here</a> to Counter
                <% end %>
                <% if msg.schedule_interview? %>
                <a data-method='post' href="<%= get_current_user.class.to_s == 'Candidate' ?
                                              accept_interview_candidate_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id)
                                              :
                                              accept_interview_job_application_path(id: msg.conversation.job_application.id, interview_id: msg.resource_id, conversation_id: msg.conversation_id) %>">Click Here </a> accept this time or
                <a class='btn-link mt-12 margin-right-5' data-toggle='modal' data-target="#candidate-interview-<%= msg.conversation.job_application.applicationable_id %>" href='#'>
                    Click Here
                </a> to change details
                <% end %>
                <% if msg.file_url.present? %>
                <hr />
                <a href=<%= msg.file_url %> target="_blank">Attachment</a>
                <% end %>
            </div>
        </div>
    </div>
</div>

<div class="chat-message left" style="margin-bottom: 14px">
    <div class="row" style="margin-top: auto">
        <div class="col-lg-7 col-md-7 col-sm-7">
            <div class="row" style="justify-content: flex-start; background: #F1F8FF;
        border-radius: 21px; border-bottom-right-radius: unset"> </div>
        </div>
        <div class="col-lg-2 col-md-2 col-sm-2">
            <div class="row" style="justify-content: flex-start"> </div>
        </div>
        <div class="col-lg-3 col-md-3 col-sm-3"></div>
    </div>
</div>
<% end %>
<%end%>
<% if @prev_date != msg.created_at.strftime('%d %b, %Y') %>
<div class="chat-date-separator" style="margin-left: 40%">
    <span>
        <% if Date.parse(@prev_date) == Date.today %>
        Today
        <% elsif Date.parse(@prev_date) == Date.yesterday %>
        Yesterday
        <% else %>
        <%= @prev_date %>
        <% end %>
    </span>
</div>
<% @prev_date = msg.created_at.strftime('%d %b, %Y') %>
<% end %>