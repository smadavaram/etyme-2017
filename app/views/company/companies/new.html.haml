= form_for [:company,@new_company] , html:{ class:'form-horizontal'} do |f|
  - if @new_company.new_record?
    = f.fields_for :invited_by do |i|
      = i.hidden_field :user_id , value: current_user.id
      = i.hidden_field :invited_by_company_id , value: current_company.id
  .row
    .col-md-6
      - f.object.company_contacts.build
      = f.fields_for :company_contacts do |contact|
        = render 'company/companies/partials/company_contact_fields', f: contact

      .col-md-12{style: "margin-left:15px"}
        = link_to_add_association 'Add Contact', f, :company_contacts , partial: 'company/companies/partials/company_contact_fields',class:'btn btn-primary pull-right'


        -#.form-group
        -#  %label.col-md-4.control-label
        -#    Send Email for On-Boarding
        -#  .col-md-8
        -#    = f.check_box :send_email
        %br/
    .col-md-6
      %fieldset
        - if @new_company.new_record?
          .form-group
            %label.control-label
              Website
              %sup.text-danger *
            = f.text_field :website, :placeholder => 'Website', required: true, class: 'form-control'
          .form-group
            %label.control-label
              Domain
              %sup.text-danger *
            = f.text_field :domain  ,:placeholder => "Domain", required: true,minlength: "3",class:'form-control'
            .note.text-muted
              Please Enter Domain like https://address
          .form-group
            %label.control-label
              Select type
            = f.select :company_type , [["Staffing/Training/Vendors", 'vendor'], ["Client/Implementation Patner", 'hiring_manager']],{include_blank: '-- Select Type --'} ,:class => 'form-control company_type', required: true
          .form-group
            %label.control-label
              Name
            = f.text_field :name , class: 'form-control' , placeholder: 'Enter Company Name'
          .form-group
            %label.control-label
              Phone
            = f.phone_field :phone , class: 'form-control' , placeholder: 'Phone'
          .form-group
            = f.fields_for :custom_fields do |lt|
              = render 'shared/custom_fields', f: lt
            %strong
              .links.col-sm-12
                = link_to_add_association '+ Add Custom Field', f, :custom_fields, class: 'text-info pull-right', partial: 'shared/custom_fields'
              %br/
  .form-actions
    .row
      .col-md-12
        = button_tag 'Cancel' , class: 'btn btn-default' , "data-dismiss"=> "modal"
        = f.button "Submit".html_safe, data: {disable_with: disable_spinning("Saving...")} , class: 'btn btn-primary'


- content_for :scripts do
  :javascript
    function validate_email() {
      var email = $('#company_company_contacts_attributes_0_email').val();
      var split_email = email.split("@");
      checkDomain(split_email[1] ,split_email[1].split(".")[0])
      // checkDomain(split_email[1])
    }

    //function validate_domain() {
    //  checkDomain($("#company_domain").val())
    //}

    function checkDomain(website, domain_name) {
      if(domain_name){
        $.ajax({
          url: '/check_for_domain',
          type: "POST",
          data: {domain_name: domain_name, website: website },
          success: function (data) {
            if(data.company_slug != ""){
              $("#company_slug").val(data.company_slug);
              $("#company_domain").val(domain_name);
              $("#company_website").val(website);
              $("#company_name").val(domain_name);
              $(".errors").text("Domain Already Register So Just Add contact to this Domain.")
            }else if(data.present_count > 0){
              $("#company_slug").val(domain_name + data.present_count);
              $("#company_domain").val(domain_name + data.present_count);
              $("#company_website").val(website);
              $("#company_name").val(domain_name);

              $(".errors").text("Domain Already Register So we added '" + data.present_count + "'." )

            }else {

              $(".errors").text("")
              $("#company_slug").val(domain_name);
              $("#company_domain").val(domain_name);
              $("#company_name").val(domain_name);
              $("#company_website").val(website);

            }
          }
        });
      } else {
        $("#company_domain").val("");
      }
    }
