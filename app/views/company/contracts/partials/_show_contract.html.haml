.w-100.p-4.bg_white
  .contract-fields_wrapper.mb-4.bg-shade
    =render 'company/contracts/partials/contract_header',contract: @contract
  .contract_links.col-sm-12.mt-2.mb-2
    = render 'company/contracts/partials/contracts_links', contract: @contract
  .row
    .col-sm-6.col-md-6.col-lg-6
      .individual_contracts_headers
        %h3= "sell-  #{@contract.sell_contract.number}"
        .text-right
          =link_to 'Add', '#', class: 'btn btn-primary'
          =link_to 'Remove', '#', class: 'btn btn-danger'
      - if @contract.sell_contract.present?
        %h3.contract_sub_heading
          Customer Details
        %div.sell-side.box
          .contract-customer-details
            .row
              .col-sm-8.customer_detail
                .w-100
                  %strong.pull-left= "Company Name: "
                  .pull-left= do_ellipsis(@contract.sell_contract.try(:company).try(:full_name),15)
                .w-100
                  %strong.pull-left= "Website: "
                  .pull-left= do_ellipsis(@contract.sell_contract&.company&.website,15)
                .w-100
                  %strong.pull-left= "Location: "
                  .pull-left= do_ellipsis(@contract.sell_contract&.company&.addresses.first&.address_1,15)
              .col-sm-4
                .rate_info.text-center
                  %strong Customer Rate
                  %span
                    = number_to_currency(get_rate(Date.today,@contract.id,'sell'))
                    %br
                    %span.btn.btn-primary.sell-change-rate{"data-toggle": "modal","data-target": "#customer_rate_change"} Change
              =render 'company/contracts/partials/customer_rate_modal'
            .table-responsive.pt-3.line-bottom
              %table.table.table-bordered.account_detail
                %thead
                  %tr
                    %th Rate
                    %th From
                    %th To
                    %th Type
                %tbody
                  - @contract.change_rates.sell_rates.each do |cr|
                    %tr
                      %td
                        = cr.rate.to_i
                      %td
                        = cr.from_date.inspect
                      %td
                        = cr.to_date.inspect
                      %td
                        = cr.rate_type.capitalize
            %div
              .w-100
                %strong.pull-left Business Contacts
              .contract_users_team
                -@contract.sell_contract.contract_sell_business_details.each do |sell_business_detail|
                  - user = sell_business_detail.company_contact.user
                  .logged-user-w.no_border_bottom{style: "width: 120px;"}
                    .avatar-w
                      %img{:alt => "", :src => user.photo}/
                    .logged-user-name= do_ellipsis(user.full_name,12)
                    .logged-user-role= user.roles.first.try(:name).try(:capitalize)
                    .logged-user-role= contact_widget(user.email, user.phone,user,chat_link: chat_link(user),color: '#BFBFC7')
        %div
          %h3.mt-2.mb-2
            Accounting & Work hours terms
          %div.sell-side.box
            %div.row
              .col-sm-12.col-md-12.col-lg-12
                %div.row
                  .col-sm-4.col-md-4.col-lg-4.p-1
                    .rate_info.text-center
                      %small
                        Submit Timesheet
                      %small.lead
                        =@contract.sell_contract&.time_sheet.capitalize
                      %p
                        =sell_contract_time_sheet('time_sheet', @contract.sell_contract&.time_sheet)
                  .col-sm-4.col-md-4.col-lg-4.p-1
                    .rate_info.text-center
                      %small
                        Approve Timesheet
                      %small.lead
                        =@contract.sell_contract&.ts_approve.capitalize
                      %p
                        =sell_contract_time_sheet('ts_approve', @contract.sell_contract&.ts_approve)

                  .col-sm-4.col-md-4.col-lg-4.p-1
                    .rate_info.text-center
                      %small
                        Invoice
                      %br
                      %small.lead
                        =@contract.sell_contract&.invoice_terms_period.capitalize
                      %p
                        =sell_contract_time_sheet('invoice_terms_period', @contract.sell_contract&.invoice_terms_period)
                %div.row
                  .col-sm-4.col-md-4.col-lg-4.p-1
                    .rate_info.text-center
                      %small
                        Receive Payment
                      %br
                      %small.lead
                        = @contract.sell_contract&.payment_term.to_i > 1 ? 'Days' : 'Day'
                      %p
                        = @contract.sell_contract&.payment_term.to_i

                %div.row
                  .col-sm-12.col-md-12.col-lg-12
                    %span
                      %b
                        Show Accounting to employee:
                        = @contract.sell_contract.show_accounting_to_employee == true ? "Yes" : "No"
        %div.contract-custome-details
          %h3.mt-2.mb-2
            Documents
          %div.sell-side.box
            .row
              .col-md-12.contract-attachment
                %ul#myTab2.nav.nav-tabs.smaller{style: "border-bottom: 0px; font-size: 0.60rem !important"}
                  %li.nav-item.active.mr-0.primary-nav
                    %a{"data-toggle" => "tab", :href => "#doc-request", class: "nav-link cumstom_nav-tab"}
                      %span.badge.bg-color-blue.txt-color-white
                      Request Decuments
                  %li.nav-item.mr-0.primary-nav
                    %a{"data-toggle" => "tab", :href => "#doc-submit", class: "nav-link cumstom_nav-tab"}
                      %span.badge.bg-color-blue.txt-color-white
                      Submit Decuments
                .col-md-12.pl-0
                  .tab-content
                    #doc-request.tab-pane.padding-top-15.active.in
                      .row
                        .col-md-12
                          .form-group
                            .table-responsive
                              %table.table.text-center.table-bordered.table-lg.table-v2.table-striped.data-table-font
                                %thead
                                  %tr{:role => "row"}
                                    %th Title
                                    %th Sent at
                                    %th Status
                                    %th Submitted Doc.
                                %tbody#request_doc
                                  - @request_documents.each do |docusign|
                                    %tr
                                      %td= docusign.documentable.title
                                      %td= docusign.created_at.strftime("%Y-%m-%d")
                                      %td= docusign.envelope_id.present? ? "Submitted" : "Document Not Submitted"
                                      %td= link_to content_tag(:i,'',class:'fa fa-paperclip fa-lg').html_safe, docusign.signed_file if docusign.signed_file.present?
                    #doc-submit.tab-pane.padding-top-15
                      .row
                        .col-md-12
                          .form-group
                            .table-responsive
                              %table.table.text-center.table-bordered.table-lg.table-v2.table-striped.data-table-font
                                %thead
                                  %tr{:role => "row"}
                                    %th Title
                                    %th Sent at
                                    %th Status
                                    %th Signers
                                    %th Envelope No
                                    %th Signed Doc.
                                %tbody#submit_doc
                                  - @signature_documents.each do |docusign|
                                    %tr
                                      %td= docusign.documentable.title
                                      %td= docusign.created_at.strftime("%Y-%m-%d")
                                      %td= docusign.is_sign_done ? "Signed" : "Pending"
                                      %td.d-flex
                                        = image_tag(docusign&.signable&.photo, class: 'data-table-image mr-1') if docusign&.signable.present?
                                        - docusign.signers&.each do |signer|
                                          =image_tag(signer.photo, class: 'data-table-image mr-1')
                                      %td= docusign.envelope_id.present? ? docusign.envelope_id : "Document Not Submitted"
                                      %td= link_to content_tag(:i,'',class:'fa fa-paperclip fa-lg').html_safe, docusign.signed_file if docusign.is_sign_done
    .col-sm-6.col-md-6.col-lg-6
      .individual_contracts_headers
        %h3= "Buy-  #{@contract.buy_contract.number}"
        .text-right
          =link_to 'Add', '#', class: 'btn btn-primary'
          =link_to 'Remove', '#', class: 'btn btn-danger'
      - if @contract.buy_contract.present?
        %h3.contract_sub_heading
          Vendor Details
        .sell-side.box
          .contract-customer-details
            .row
              .col-sm-6.pr-0.customer_detail
                .w-100
                  %strong.pull-left= "Name: "
                  .pull-left= do_ellipsis(@contract.candidate.full_name,15)
                .w-100
                  %strong.pull-left= "Contract Type: "
                  .pull-left{title: @contract.buy_contract.get_contract_type_label}= @contract.buy_contract.contract_type
                .w-100
                  %strong.pull-left= "Address: "
                  .pull-left= do_ellipsis(@contract.candidate.addresses.first&.address_1,15)
              .col-sm-6.pr-0
                .rate_info.text-center.d-inline-block
                  %strong{title: "Freelancer Rate"} Fre. Rate
                  %span
                    %br
                    =  number_to_currency(get_rate(Date.today,@contract.id, 'buy'))
                    %br
                    %span.btn.btn-primary.sell-change-rate{"data-toggle": "modal","data-target": "#freelancer_rate_change"} Change
                .rate_info.text-center.d-inline-block
                  %strong USCIS
                  %span
                    %br
                    =  number_to_currency(@contract.buy_contract.uscis_rate)
                    %br
                    %span.btn.btn-primary.sell-change-rate.disabled Change
              =render 'company/contracts/partials/freelancer_rate_modal'
            .table-responsive.pt-3.line-bottom
              %table.table.table-bordered.account_detail
                %thead
                  %tr
                    %th Rate
                    %th From
                    %th To
                    %th Type
                %tbody
                  - @contract.change_rates.buy_rates.each do |cr|
                    %tr
                      %td
                        = cr.rate.to_i
                      %td
                        = cr.from_date.inspect
                      %td
                        = cr.to_date.inspect
                      %td
                        = cr.rate_type.capitalize
            %div
              .w-100
                %strong.pull-left Business Contacts
                - if @contract.buy_contract.company.present?
                  %pull-right= @contract.buy_contract.company.full_name
              .contract_users_team
                - user = @contract.candidate
                .logged-user-w.no_border_bottom{style: "width: 120px;"}
                  .avatar-w
                    %img{:alt => "", :src => user.photo}/
                  .logged-user-name= do_ellipsis(user.full_name,12)
                  .logged-user-role= contact_widget(user.email, user.phone,user,chat_link: chat_link(user),color: '#BFBFC7')
                - if @contract.buy_contract.company.present?
                  - user = @contract.company.owner
                  .logged-user-w.no_border_bottom{style: "width: 120px;"}
                    .avatar-w
                      %img{:alt => "", :src => user.photo}/
                    .logged-user-name= do_ellipsis(user.full_name,12)
                    .logged-user-role= user.roles.first.try(:name).try(:capitalize)
                    .logged-user-role= contact_widget(user.email, user.phone,user,chat_link: chat_link(user),color: '#BFBFC7')
        %div
          %h3.mt-2.mb-2
            Accounting & Work hours terms
          .contract-custome-details.box
            .row
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center
                  %small
                    Submit Timesheet
                  %small.lead
                    =@contract.buy_contract&.time_sheet.capitalize
                  %p
                    =buy_contract_time_sheet('time_sheet', @contract.buy_contract&.time_sheet)
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center
                  %small
                    Approve Timesheet
                  %small.lead
                    =@contract.buy_contract&.ts_approve.capitalize
                  %p
                    =buy_contract_time_sheet('ts_approve',@contract.buy_contract&.ts_approve)
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center
                  %small
                    =@contract&.buy_contract&.contract_type == 'C2C' ? 'Vendor Bill' : 'Salary Calculation'
                  %small.lead
                    =@contract.buy_contract&.salary_calculation.capitalize
                  %p
                    =buy_contract_time_sheet('salary_calculation', @contract.buy_contract&.salary_calculation)
            .row
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center
                  %small Salary Process
                  %br
                  %small.lead
                    =@contract.buy_contract&.salary_calculation.capitalize
                  %p
                    =buy_contract_time_sheet('salary_process', @contract.buy_contract&.salary_calculation)
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center.d-inline-block
                  %strong{title: "Freelancer Rate"} Freelancer Rate
                  %span
                    %br
                    =  number_to_currency(get_rate(Date.today,@contract.id, 'buy'))
                    %br
                    %span.btn.btn-primary.sell-change-rate{"data-toggle": "modal","data-target": "#freelancer_rate_change"} Change Rate
              .col-sm-4.col-md-4.col-lg-4.p-1
                .rate_info.text-center.d-inline-block
                  %strong USCIS
                  %span
                    %br
                    =  number_to_currency(@contract.buy_contract.uscis_rate)
                    %br
                    %span.btn.btn-primary.sell-change-rate.disabled Change Rate
            - if @contract&.buy_contract&.contract_type == 'C2C'
              .row
                .col-sm-4.col-md-4.col-lg-4.p-1
                  .rate_info.text-center
                    %small
                      Vendor Payment
                    %small.lead
                      =@contract.buy_contract&.invoice_recepit.capitalize
                    %p
                      =buy_contract_time_sheet('invoice_recepit', @contract.buy_contract&.invoice_recepit)
            .row
              .col-sm-12.col-md-12.col-lg-12
                %span
                  %b
                    = "Salary Date: #{@contract&.company&.payroll_infos&.first&.sal_cal_date.try(:strftime, '%d')} of each month"
        %div
          %h3.mt-2.mb-2
            Documents
          .contract-custome-details.box
            .row
              .col-md-12.contract-attachment
                %ul#myTab2.nav.nav-tabs.smaller{style: "border-bottom: 0px; font-size: 0.60rem !important"}
                  %li.nav-item.active.primary-nav.mr-0
                    %a{"data-toggle" => "tab", :href => "#buy_send_documents", class: "nav-link cumstom_nav-tab"}
                      %span.badge.bg-color-blue.txt-color-white
                      Submit Documents
                  %li.nav-item.primary-nav.mr-0
                    %a{"data-toggle" => "tab", :href => "#buy_emp_req_docs", class: "nav-link cumstom_nav-tab"}
                      %span.badge.bg-color-blue.txt-color-white
                      Request Documents
                  - if @contract.buy_contract.company.present?
                    %li.nav-item.primary-nav.mr-0
                      %a{"data-toggle" => "tab", :href => "#buy_ven_req_docs", class: "nav-link cumstom_nav-tab"}
                        %span.badge.bg-color-blue.txt-color-white
                        Vendor Req. Documents
                .col-md-12.pl-0
                  .tab-content
                    #buy_send_documents.tab-pane.padding-top-15.active.in
                      .row
                        .col-md-12
                          .form-group
                            .table-responsive
                              %table.table.text-center.table-bordered.table-lg.table-v2.table-striped.data-table-font
                                %thead
                                  %tr{:role => "row"}
                                    %th Title
                                    %th Sent at
                                    %th Status
                                    %th Signers
                                    %th Envelope No
                                    %th Signed Doc.
                                %tbody#buy_send_documents_table
                                  - @candidate_signature_documents.each do |docusign|
                                    %tr
                                      %td= docusign.documentable.title
                                      %td= docusign.created_at.strftime("%Y-%m-%d")
                                      %td= docusign.is_sign_done ? "Signed" : "Pending"
                                      %td.d-flex
                                        = image_tag(docusign&.signable&.photo, class: 'data-table-image mr-1')
                                        - docusign.signers&.each do |signer|
                                          =image_tag(signer.photo, class: 'data-table-image mr-1')
                                      %td= docusign.envelope_id.present? ? docusign.envelope_id : "Document Not Submitted"
                                      %td= link_to content_tag(:i,'',class:'fa fa-paperclip fa-lg').html_safe, docusign.signed_file if docusign.is_sign_done
                    #buy_emp_req_docs.tab-pane.padding-top-15
                      .row
                        .col-md-12
                          .form-group
                            .table-responsive
                              %table.table.text-center.table-bordered.table-lg.table-v2.table-striped.data-table-font
                                %thead
                                  %tr{:role => "row"}
                                    %th Title
                                    %th Sent at
                                    %th Status
                                    %th Submitted Doc.
                                %tbody#buy_emp_req_docs_table
                                  - @candidate_request_documents.each do |docusign|
                                    %tr
                                      %td= docusign.documentable.title
                                      %td= docusign.created_at.strftime("%Y-%m-%d")
                                      %td= docusign.envelope_id.present? ? "Submitted" : "Document Not Submitted"
                                      %td= link_to content_tag(:i,'',class:'fa fa-paperclip fa-lg').html_safe, docusign.signed_file if docusign.signed_file.present?
                    #buy_ven_req_docs.tab-pane.padding-top-15
                      .row
                        .col-md-12
                          .form-group
                            .table-responsive
                              %table.table.text-center.table-bordered.table-lg.table-v2.table-striped.data-table-font
                                %thead
                                  %tr{:role => "row"}
                                    %th Title
                                    %th Sent at
                                    %th Status
                                    %th Signers
                                    %th Envelope No
                                    %th Signed Doc.
                                %tbody#buy_ven_req_docs_table
                                  - @vendor_signature_documents.each do |docusign|
                                    %tr
                                      %td= docusign.documentable.title
                                      %td= docusign.created_at.strftime("%Y-%m-%d")
                                      %td= docusign.is_sign_done ? "Signed" : "Pending"
                                      %td.d-flex
                                        = image_tag(docusign&.signable&.photo, class: 'data-table-image mr-1')
                                        - docusign.signers&.each do |signer|
                                          =image_tag(signer.photo, class: 'data-table-image mr-1')
                                      %td= docusign.envelope_id.present? ? docusign.envelope_id : "Document Not Submitted"
                                      %td= link_to content_tag(:i,'',class:'fa fa-paperclip fa-lg').html_safe, docusign.signed_file if docusign.is_sign_done

        %div
          %h3.mt-2.mb-2
            Commission
          %div.contract-custome-details.box
            %table.table.table-bordered
              %thead
                %tr
                  %th Name
                  %th Rate
                  %th Frequency
                  %th Limit
                -@contract.buy_contract.contract_sale_commisions.each do |csc|
                  %tr
                    %td
                      =csc.csc_accounts.map{ |a|  a.accountable.full_name}.join(', ')
                    %td
                      =csc.rate
                    %td
                      =csc.frequency
                    %td
                      =csc.limit
            %div.contract-custome-details
              %strong
                Payroll date:
              %span
                = @contract.buy_contract.payroll_date&.try(:strftime, '%e').to_s+' of each month'
            %div.contract-custome-details
              %strong
                Comissiom Payment terms:
              %span
                = @contract.buy_contract.commission_payment_term




- if @contract.pending? && !@contract.is_sent?(current_company)
  - content_for :modals do
    #ajax-modal
    = render 'company/contracts/partials/accept_contract_modal' , contract: @contract , status: 'accept'
    = render 'company/contracts/partials/accept_contract_modal' , contract: @contract , status: 'reject'


  - content_for :scripts do
    :javascript
      function openAccept(){
        $("#contract-accept-#{@contract.id}").modal('show');
      }
      $(".upload-doc-button").click(function(){
        file = '.'+$(this).attr('id');
        filepicker.setKey("#{ENV['filepicker_api_key']}");
        filepicker.pick({},function(blob){
          $(file).val(blob.url);
          $(file).parent().submit();
        });
      });
- content_for :scripts do
  :javascript

    $('.contract_progress').attr('data-content','0%');
    $('.contract_progress').css('left', '#{(((@contract.contract_progress.to_f*54)/100).to_f+21).round}%');
    $('.contract_progress').attr('data-content','#{@contract.contract_progress.to_f.round}%');

    $(document).on('click', '.buy-change-rate', function(){
      $('#buy-change-rate').toggleClass('hidden');
    });

    $(document).on('click', '.sell-change-rate', function(){
      $('#sell-change-rate').toggleClass('hidden');
    });



