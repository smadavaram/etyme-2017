#content
  %body
    %section#widget-grid
      .row
        %article.col-xs-12.col-sm-12.col-md-12.col-lg-12.sortable-grid.ui-sortable
          #wid-id-1.jarviswidget.jarviswidget-color-blueDark.jarviswidget-sortable{"data-widget-editbutton" => "false", :role => "widget"}
            %header{:role => "heading"}
              %span.widget-icon
                %i.fa.fa-table
              %h2 Admins
              %span.jarviswidget-loader
                %i.fa.fa-refresh.fa-spin
            / widget div
            %div{:role => "content"}
              .jarviswidget-editbox
              .widget-body.no-padding
                #datatable_fixed_column_wrapper.dataTables_wrapper.form-inline.dt-bootstrap.no-footer
                  %table#example#datatable_fixed_column.table.table-striped.table-bordered.dataTable.no-footer{"aria-describedby" => "datatable_fixed_column_info", :role => "grid", :style => "width: 100%;", :width => "100%"}
                    %thead
                      %tr{:role => "row"}
                        %th.hasinput{ :style => "width:17%"}
                          %input.form-control{:placeholder => "Filter Pic", :type => ""}/
                        %th.hasinput{ :style => "width:18%"}
                          %input.form-control{:placeholder => "Filter Name", :type => "text"}/
                        %th.hasinput{ :style => "width:16%"}
                          %input.form-control{:placeholder => "Filter Email", :type => ""}/
                        %th.hasinput{ :style => "width:17%"}
                          %input.form-control{:placeholder => "Filter Roles", :type => "text"}/
                        %th.hasinput
                          %input.form-control{:placeholder => "Filter Last Login", :type => "text"}/
                        %th.hasinput{ :style => "width:16%"}
                          %input.form-control{:placeholder => "Filter Groups", :type => "text"}/
                        %th.hasinput
                          %input.form-control{:placeholder => "Last Reminder", :type => "text"}/
                        %th.hasinput{ :style => "width:16%"}
                          %input.form-control{:placeholder => "Filter Actions", :type => ""}/
                      %tr{:role => "row"}
                        %th Pic
                        %th{"data-hide" => "phone"} Name
                        %th Email
                        %th Roles
                        %th Last Login
                        %th Groups
                        %th Last Reminder
                        %th{"data-hide" => "phone,tablet"}
                          Actions
                    %tbody
                      - @admins.each_with_index do |admin , index|
                        %tr
                          %td= image_tag admin.photo, alt: '', width: '20'
                          %td= link_to admin.full_name , company_user_profile_path(admin)  , target: '_blank'
                          %td= admin.email
                          %td= admin.roles.map(&:name).join(", ").gsub("_"," ").upcase
                          %td= admin.try(:last_sign_in_at).try(:localtime).try(:strftime,"%A, %d %b %Y %l:%M %p")
                          %td
                            - admin.groups.each do |group|
                              %span.badge.bg-color-blue.margin-bottom-5
                                = group.try(:group_name).try(:titleize)
                          %td
                            - reminder = find_reminderable_last_reminder(admin)
                            = reminder.present? ? reminder.try(:title).try(:titleize) : ''
                          %td
                            = link_to raw("<i class='fa fa-bell '></i>"),company_user_add_reminder_path(admin)  ,class: 'btn btn-primary btn-xs margin-bottom-5', remote: :true,title: "Remind Me"
                            = link_to raw("<i class='fa fa-edit '></i>") , edit_admin_path(admin) , class: 'btn btn-xs btn-default btn-primary margin-bottom-5' ,remote: true,title: "Edit #{admin.full_name}"
                            = link_to raw("<i class='fa fa-users '></i>"), company_user_assign_groups_path(admin) , remote:true,class: 'btn btn-xs btn-success margin-bottom-5',title: "Manage Groups"
                            -#= link_to raw("<i class='fa fa-times '></i>") , admin_path(admin) , method: :delete ,  class: 'btn btn-xs btn-default btn-danger' ,title: "Delete #{admin.full_name}" ,data: {confirm: 'Are you sure?', verify: 'Confirm', verify_text: 'Type "Confirm" to confirm'}

                  - if @admins.count >15
                    .dt-toolbar-footer
                      =  digg_pagination(@admins)
:css
  .form-control
  {
    background-color: white !important;
  }
  .digg_pagination
  {
    background-color: #fafafa !important;
  }
-content_for :scripts do
  :javascript
    $(document).ready(function() {
     pageSetUp();
      var responsiveHelper_dt_basic = undefined;
      var responsiveHelper_datatable_fixed_column = undefined;
      var responsiveHelper_datatable_col_reorder = undefined;
      var responsiveHelper_datatable_tabletools = undefined;
      var otable = $('#datatable_fixed_column').DataTable({
            "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>"+
                    "t"+
                    "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
            "autoWidth" : true,
            "oLanguage": {
                "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
            }

        });

      $("div.toolbar").html('<div class="text-right">#{ link_to 'NEW' , new_admin_path , remote: true , class: 'btn btn-success btn-md pull-right header-btn hidden-mobile'}</div>');

      // Apply the filter
      $("#datatable_fixed_column thead th input[type=text]").on( 'keyup change', function () {
        otable
            .column( $(this).parent().index()+':visible' )
            .search( this.value )
            .draw();

      } );

    });

